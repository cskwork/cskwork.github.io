<!doctype html>
<html lang="en" dir="ltr" class="docs-version-current">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Loading Photos from the Filesystem Using A Key-Value Store</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="https://cskwork.github.io/docs/react/your-first-app/loading-photos"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="og:image" content="https://velog.velcdn.com/images/csk917work/profile/a8dd9a56-1e38-417b-833f-ec12bd72b998/image.png"><meta data-rh="true" name="twitter:image" content="https://velog.velcdn.com/images/csk917work/profile/a8dd9a56-1e38-417b-833f-ec12bd72b998/image.png"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:domain" content="ionicframework.com"><meta data-rh="true" name="twitter:site" content="@ionicframework"><meta data-rh="true" name="twitter:creator" content="ionicframework"><meta data-rh="true" name="fb:page_id" content="1321836767955949"><meta data-rh="true" name="og:type" content="website"><meta data-rh="true" name="og:site_name" content="Ionic Framework Docs"><meta data-rh="true" property="og:title" content="Loading Photos from the Filesystem | workerRabbit"><meta data-rh="true" property="og:description" content="Loading Photos from the Filesystem Using A Key-Value Store"><meta data-rh="true" name="description" content="We‚Äôve implemented photo taking and saving to the filesystem, now learn how Ionic leverages Capacitor Preferences API for loading our photos in a key-value store."><link data-rh="true" rel="shortcut icon" href="https://velog.velcdn.com/images/csk917work/profile/a8dd9a56-1e38-417b-833f-ec12bd72b998/image.png"><link data-rh="true" rel="canonical" href="https://cskwork.github.io/docs/react/your-first-app/loading-photos"><link data-rh="true" rel="alternate" href="https://cskwork.github.io/docs/react/your-first-app/loading-photos" hreflang="en"><link data-rh="true" rel="alternate" href="https://cskwork.github.io/docs/ja/react/your-first-app/loading-photos" hreflang="ja"><link data-rh="true" rel="alternate" href="https://cskwork.github.io/docs/react/your-first-app/loading-photos" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://O9QSL985BS-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-TKMGCBC",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>



<link rel="search" type="application/opensearchdescription+xml" title="workerRabbit" href="/docs/opensearch.xml"><link rel="stylesheet" href="/docs/assets/css/styles.ac213ede.css">
<link rel="preload" href="/docs/assets/js/runtime~main.20c07707.js" as="script">
<link rel="preload" href="/docs/assets/js/main.5c8eeb55.js" as="script">
</head>
<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TKMGCBC" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"></a><a class="navbar__item navbar__link" href="/docs/">Guide</a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">üåú</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">üåû</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_YtjA"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_dnJg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"></a><a class="navbar__item navbar__link" href="/docs/">Guide</a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">üåú</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">üåû</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_YtjA"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><main class="docMainContainer_XeRd docMainContainerEnhanced_HqpQ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_nDMA"><div class="docItemContainer_p3Qu"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->v7</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_diN6"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Loading Photos from the Filesystem</h1></header><p>We‚Äôve implemented photo taking and saving to the filesystem. There‚Äôs one last piece of functionality missing: the photos are stored in the filesystem, but we need a way to save pointers to each file so that they can be displayed again in the photo gallery.</p><p>Fortunately, this is easy: we‚Äôll leverage the Capacitor <a href="https://capacitorjs.com/docs/apis/preferences" target="_blank" rel="noopener noreferrer">Preferences API</a> to store our array of Photos in a key-value store.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="preferences-api">Preferences API<a aria-hidden="true" class="hash-link" href="#preferences-api" title="Direct link to heading">‚Äã</a></h2><p>Begin by defining a constant variable that will act as the key for the store before the <code>usePhotoGallery</code> function definition in <code>src/hooks/usePhotoGallery.ts</code>:</p><div class="codeBlockContainer_I0IT language-tsx"><div class="codeBlockContent_wNvx tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token constant">PHOTO_STORAGE</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;photos&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">usePhotoGallery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then, use the <code>Storage</code> class to get access to the get and set methods for reading and writing to device storage:</p><p>At the end of the <code>takePhoto</code> function, add a call to <code>Preferences.set()</code> to save the Photos array. By adding it here, the Photos array is stored each time a new photo is taken. This way, it doesn‚Äôt matter when the app user closes or switches to a different app - all photo data is saved.</p><div class="codeBlockContainer_I0IT language-tsx"><div class="codeBlockContent_wNvx tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token maybe-class-name">Preferences</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant">PHOTO_STORAGE</span><span class="token punctuation">,</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token plain">newPhotos</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>With the photo array data saved, we will create a method that will retrieve the data when the hook loads. We will do so by using React&#x27;s <code>useEffect</code> hook. Insert this above the <code>takePhoto</code> declaration. Here is the code, and we will break it down:</p><div class="codeBlockContainer_I0IT language-tsx"><div class="codeBlockContent_wNvx tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">loadSaved</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> value </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">await</span><span class="token plain"> </span><span class="token maybe-class-name">Preferences</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant">PHOTO_STORAGE</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> photosInPreferences </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">value </span><span class="token operator">?</span><span class="token plain"> </span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token maybe-class-name">UserPhoto</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">let</span><span class="token plain"> photo </span><span class="token keyword">of</span><span class="token plain"> photosInPreferences</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> file </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">await</span><span class="token plain"> </span><span class="token maybe-class-name">Filesystem</span><span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        path</span><span class="token operator">:</span><span class="token plain"> photo</span><span class="token punctuation">.</span><span class="token plain">filepath</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        directory</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Directory</span><span class="token punctuation">.</span><span class="token maybe-class-name">Data</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token comment">// Web platform only: Load the photo as base64 data</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      photo</span><span class="token punctuation">.</span><span class="token plain">webviewPath </span><span class="token operator">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">data:image/jpeg;base64,</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">file</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation">data</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token function">setPhotos</span><span class="token punctuation">(</span><span class="token plain">photosInPreferences</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token function">loadSaved</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This seems a bit scary at first, so let&#x27;s walk through it, first by looking at the second parameter we pass into the hook: the dependency array <code>[]</code>.</p><p>The useEffect hook, by default, gets called each time a component renders, unless, we pass in a dependency array. In that case, it will only run when a dependency gets updated. In our case we only want it to be called once. By passing in an empty array, which will not be changed, we can prevent the hook from being called multiple times.</p><p>The first parameter to <code>useEffect</code> is the function that will be called by the effect. We pass in an anonymous arrow function, and inside of it we define another asynchronous method and then immediately call this. We have to call the async function from within the hook as the hook callback can&#x27;t be asynchronous itself.</p><p>On mobile (coming up next!), we can directly set the source of an image tag - <code>&lt;img src=‚Äùx‚Äù /&gt;</code> - to each photo file on the Filesystem, displaying them automatically. On the web, however, we must read each image from the Filesystem into base64 format, because the Filesystem API stores them in base64 within <a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" target="_blank" rel="noopener noreferrer">IndexedDB</a> under the hood.</p><p>That‚Äôs it! We‚Äôve built a complete Photo Gallery feature in our Ionic app that works on the web. Next up, we‚Äôll transform it into a mobile app for iOS and Android!</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ionic-team/ionic-docs/edit/main/docs/react/your-first-app/4-loading-photos.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon-edit iconEdit_UdV7"><path d="M7 0C3.13438 0 0 3.21563 0 7.17813C0 10.35 2.00625 13.0375 4.7875 13.9875C4.83125 13.9969 4.86875 14 4.90625 14C5.16563 14 5.26562 13.8094 5.26562 13.6438C5.26562 13.4719 5.25938 13.0219 5.25625 12.4219C4.99375 12.4812 4.75938 12.5063 4.55 12.5063C3.20313 12.5063 2.89687 11.4594 2.89687 11.4594C2.57812 10.6313 2.11875 10.4094 2.11875 10.4094C1.50938 9.98125 2.11562 9.96875 2.1625 9.96875H2.16563C2.86875 10.0312 3.2375 10.7125 3.2375 10.7125C3.5875 11.325 4.05625 11.4969 4.475 11.4969C4.80312 11.4969 5.1 11.3906 5.275 11.3094C5.3375 10.8469 5.51875 10.5312 5.71875 10.35C4.16563 10.1688 2.53125 9.55313 2.53125 6.80312C2.53125 6.01875 2.80312 5.37813 3.25 4.87813C3.17812 4.69688 2.9375 3.96563 3.31875 2.97813C3.31875 2.97813 3.36875 2.9625 3.475 2.9625C3.72812 2.9625 4.3 3.05937 5.24375 3.71562C5.80312 3.55625 6.4 3.47812 6.99687 3.475C7.59062 3.47812 8.19063 3.55625 8.75 3.71562C9.69375 3.05937 10.2656 2.9625 10.5188 2.9625C10.625 2.9625 10.675 2.97813 10.675 2.97813C11.0563 3.96563 10.8156 4.69688 10.7437 4.87813C11.1906 5.38125 11.4625 6.02187 11.4625 6.80312C11.4625 9.55937 9.825 10.1656 8.26562 10.3438C8.51562 10.5656 8.74063 11.0031 8.74063 11.6719C8.74063 12.6313 8.73125 13.4062 8.73125 13.6406C8.73125 13.8094 8.82812 14 9.0875 14C9.125 14 9.16875 13.9969 9.2125 13.9875C11.9969 13.0375 14 10.3469 14 7.17813C14 3.21563 10.8656 0 7 0Z" fill="currentColor"></path></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div><div class="spacer"></div></div><div class="end"><div class="toc-wrapper"><h2>Contents</h2><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#preferences-api" class="table-of-contents__link toc-highlight">Preferences API</a></li></ul></div></div></div></div></div></main></div></div></div></div>
<script src="/docs/assets/js/runtime~main.20c07707.js"></script>
<script src="/docs/assets/js/main.5c8eeb55.js"></script>
</body>
</html>