# 자바스크립트 소개 및 이벤트 루프 작동 방법

### 짧은 요약:

JS는 웹페이지에 역동성 (사용자와 상호작용) 을 주기 위한 언어. 

브라우저에서 JS 엔진 - 가상 머신으로 개발자가 작성한 스크립트를 읽고 컴파일하는 과정을 거침. 

### 자바스크립트에 대한 요약 (Bing copilot):

자바스크립트는 **웹 페이지에 생동감**을 불어넣기 위해 만들어진 프로그래밍 언어입니다². 스크립트라고 부르는 프로그램을 작성하고, 브라우저에서 실행할 수 있습니다¹. 자바스크립트는 **HTML과 CSS와 완전히 통합**되며, **웹 페이지의 내용이나 스타일을 수정**하거나 **사용자와 상호작용**할 수 있습니다⁴.

자바스크립트는 **ECMAScript라는 표준**에 따라 개발되었으며, 다양한 환경에서 사용될 수 있습니다². 브라우저에서 자바스크립트를 실행하기 위해서는 자바스크립트 엔진이라고 하는 가상 머신이 필요합니다¹. 각 브라우저마다 다른 엔진을 사용하며, 엔진은 스크립트를 읽고 컴파일하고 실행하는 과정을 거칩니다¹.

자바스크립트는 **객체 기반의 언어**로서, 함수도 객체로 취급됩니다¹. 모든 객체는 프로토타입이라고 하는 숨겨진 링크를 가지고 있으며, 이를 통해 상속과 같은 기능을 구현할 수 있습니다¹. 자바스크립트에서는 실행 컨텍스트라고 하는 환경 안에서 코드가 동작하며, 변수의 유효 범위나 호이스팅 등의 개념과 관련이 있습니다¹.

자바스크립트가 할 수 있는 일은 많지만, 할 수 없는 일도 있습니다. 예를 들어, 자바스크립트는 **디스크 조작이나 카메라나 마이크 같은 디바이스와의 상호작용에 제한**이 있습니다⁴. 또한 **타 사이트나 도메인에서 데이터를 받아오거나 다른 창의 정보에 접근하는 것도 제한**됩니다⁴. 이런 제약사항은 **사용자의 보안**을 위해 만들어졌습니다.

더 알아보시려면 아래의 참조 문서들을 확인해보세요.

- [자바스크립트란?](https://ko.javascript.info/intro) ²
- [JavaScript 입문 | 개요 | devkuma](https://www.devkuma.com/docs/javascript/%EA%B0%9C%EC%9A%94/) ³
- [JavaScript가 뭔가요? - Web 개발 학습하기 | MDN](https://developer.mozilla.org/ko/docs/Learn/JavaScript/First_steps/What_is_JavaScript) ⁴
- [[자바스크립트] 1. 소개 — Gyoogle (규글)]([https://bing.com/search?q=자바스크립트+소개+�](https://bing.com/search?q=%ec%9e%90%eb%b0%94%ec%8a%a4%ed%81%ac%eb%a6%bd%ed%8a%b8+%ec%86%8c%ea%b0%9c+%ec) %9a %94

---

## 자바스크립트 소개 : 웹에 생동감을 불어넣는 언어

- 작성한 프로그램을 스크립트라고 부름
- 스크립트는 특별한 준비나 컴파일 없이 문자 형태로 작성 및 실행 가능
- 웹 페이지를 불러올 때 스크립트는 자동으로 실행됨.
- 역사 : 모카 → 라이브스크립트 → 자바스크립트
- 표준화된 ECMAScript 방식을 따름 - 웹 페이지 호환성 보장

## 자바스크립트 엔진 : 1 브라우저의 가상 머신

- 브라우저엔 '자바스크립트 가상 머신’이라 불리는 엔진이 내장되어 있고 해당 엔진을 통해서 스크립트가 실행됨.
- V8 : Chrome, Opera에서 사용하는  무료 오픈 소스 소프트웨어입니다.
- SpiderMonkey : Firefox에서 사용 - 넷스케이프 커뮤니케이션즈에서 만들었고 현재 모질라 재단에서 유지보수.
- ChakraCore : IE, Edge에서 사용 - 오픈 소스 - ChakraCore로 개발. https://github.com/chakra-core/ChakraCore

## 자바스크립트 엔진 : 2 어떻게 작동해?

1. **파싱**. 엔진(브라우저 내장 엔진)이 스크립트를 읽어들임 (파싱).
2. **컴파일**. 읽은 스크립트를 기계어로 변환 (컴파일).
3. **실행**. 기계어로 변환된 코드가 실행됨

엔진은 각 단계 별 최적화를 진행하여 (컴파일 완료 후 실행 중인 코드를 감시하고 분석한 결과를 기반으로 기계어로 변환된 코드도 다시 최적화 진행) 최적의 성능을 내고 있다.

## 브라우저에서의 자바스크립트 : 웹 페이지를 조작하기

- **HTML 페이지 수정.** 페이지에 새로운 HTML을 추가하거나 기존 HTML, 혹은 스타일 수정
- **사용자 행동에 반응.** 마우스 클릭이나 포인터의 움직임, 키보드 키 눌림 등
- **네트워크를 통해 원격 서버에 요청, 파일 다운로드, 업로드**하기(AJAX나 COMET과 같은 기술 사용)
- **쿠키 제어.** 쿠키를 가져오거나 설정하기. 사용자에게 질문을 건네거나 메시지 보여줌
- **로컬 스토리지.** 클라이언트 측에 데이터 저장

## 브라우저에서의 자바스크립트 : 악성 코드 방어

### 자바스크립트가 브라우저에서 할 수 없는 일

- **스크립트는 디스크 조작 불가**. 웹페이지 내 스크립트는 디스크에 저장된 임의의 파일을 읽거나 쓰고, 복사하거나 실행할 때 제약. 운영체제가 지원하는 기능을 브라우저가 직접 쓰지 못하게 막힘. 메모리, CPU 저수준 영역을 조작하지 않음.
- **특정 상황에서만 파일 접근 허용.** 모던 브라우저로 파일 조작 가능 단 접근 제한. 사용자가 브라우저 창에 파일을 ‘끌어다 두거나’ `<input>` 태그를 통해 파일을 선택할 때와 같은 상황.
- **카메라나 마이크 같은 디바이스와 상호 작용하려면 사용자의 명시적인 허가 필요**. 자바스크립트가 활성화된 페이지라도 사용자 몰래 웹 카메라를 작동 시켜 수집한 정보를 국가안보국(NSA)과 같은 곳에 몰래 전송 불가.
- **브라우저 내 탭과 창은 대개 서로의 정보를 알 수 없음 (**동일 출처 정책). 그런데 자바스크립트를 사용해 한 창에서 다른 창을 열 때는 예외가 적용됩니다. 하지만 이 경우에도 도메인이나 프로토콜, 포트가 다르다면 페이지에 접근할 수 없습니다. 이런 제약사항을 '동일 출처 정책(Same Origin Policy)'이라 부릅니다. 이 정책을 피하려면 두 페이지는 데이터 교환에 동의해야 하고, 동의와 관련된 특수한 자바스크립트 코드를 포함하고 있어야 합니다. 자세한 사항은 추후 학습하도록 하겠습니다. 다시 한번 강조하지만, 이런 제약사항은 사용자의 보안을 위해 만들어졌습니다. http://anysite.com에서 받아온 페이지가 http://gmail.com에서 받아온 페이지 상의 정보에 접근해 중요한 개인정보를 훔치는 걸 막기 위함.
- **타 사이트나 도메인에서 데이터를 받아오는 건 불가능.** 자바스크립트를 이용하면 페이지를 생성한 서버와 쉽게 정보를 주고받을 수 있지만 타 사이트나 도메인에서 데이터를 받아오는 건 불가능. 가능하다 할지라도 원격 서버에서 명확히 승인을 해줘야 합니다(HTTP 헤더 등을 이용). 이 역시 보안을 위해 만들어진 제약사항입니다.

## 자바스크립트 액션 : 이벤트 루프 실행

자바스크립트 엔진은 싱글-쓰레드로 작동합니다. 동시에 여러 가지 작업이 불가하다는 의미입니다. 일을 한 번에 하나씩 밖에 못 하는 사원을 생각하면 될 거에요. (순차적으로 빠른 속도로 일을 처리하는 효율적인 직원이 아닐까요?🐱‍👤).

그럼 뭐가 문제일까요?

브라우저가 로딩할 때 30초 정도 걸리는 일 (setTimeout)을 자바스크립트 엔진(사원)으로 보내면 사용자(고객사)는 30초 동안 다른 일은 못하고 계속 기다려야 해요 ㅠㅠ. 그럼 사이트를 누가 쓰겠어요 😒

그래서 자바스크립트 엔진은 도움이 필요해요!

### 🎉 Web API

웹 브라우저는 DOM API, setTimeout, HTTP request등의 Web API를 제공해서 자바스크립트 엔진이 더 효율적으로 일할 수 있는 환경을 만들어주는데요.

사용자가 브라우저를 누르고 html에 담겨있는 스크립트를 실행하면 어떤 일이 발생하냐면요. 스크립트 안에 담겨있는 함수가 자바스크립트 엔진의 일부인 콜 스택 (call stack)에 추가돼요. 콜스택은 프로그램이 사용할 메소드 정보를 보관하는 임시공간인데요. 상사가 부하직원에게 오늘 처리해야 할 서류를 책상 위에 하나씩 쌓는 이미지를 그리면 스택의 개념을 이해할 수 있어요. FILO (First in, last out) 즉 먼저 올려둔 서류는 가장 나중에 처리하는 거예요. 너무 바빠서 가장 위에 올려둔 서류부터 처리하는 직원. 기술 용어로는 push - 콜 스택에 밀어넣다 , pop - 콜 스택에서 빼낸다고 해요. 그림으로 더 자세하게 설명해볼게요!

```jsx
greet();
respond();

function greet(){
	return "Hello!"
}
function respond(){
	return setTimeout{ ()=>{
		return "Hey!"
	}, 1000))
}
```

### 1 함수 실행 및 종료

 [//]: #(gid1.6.gif)

호출 스택 : JS 엔진의 일부

- 1 greet() 함수가 실행되면 호출 스택으로 전송(푸시)됨
- 2 greet() 함수가 값(”Hello!”)을 반환하여 호출 스택에서 제거됨(팝)

### 2 메인 스레드 계속 실행

 [//]: #(gif2.1.gif)

- 1 respond 함수가 실행되면서 setTimeout 함수 처리 요청을 하면 WebAPI가 받아서 익명 함수 (”Hey”) 콜백을 처리함
- 2 respond 함수는 스택에서 제거(팝)되어 스스로를 반환

**setTimeout** : 웹 API, 메인 스레드를 차단하지 않고 실행.

**콜백(callback)** 또는 콜백 함수(callback function) : 다른 함수의 인자로써 이용되는 함수

### 3 대기중인 함수

 [//]: #(gif3.1.gif)

- 웹 API는 setTimeout 함수의 1000ms 지연으로 인해 즉시 실행되지 않고 큐로 전달

### 4 이벤트 루프가 큐를 가져옴

 [//]: #(gif4.gif)

- 이벤트 루프는 큐를 호출 스택과 연결. 따라서 호출 스택이 비어 있으면
- 큐의 첫 번째 항목이 호출 스택에 추가됨.

### 5 함수 실행 및 종료

 [//]: #(gif5.gif)

- 1 콜백이 호출 스택에 추가됨.
- 2 값(”Hey”)을 반환하기 위해 실행 한 다음 제거(pop) 됨.

### TEST

```jsx
const foo = () => console.log("First");
const bar = () => setTimeout(() => console.log("Second"), 500);
const baz = () => console.log("Third");

bar();
foo();
baz();

/*
결과 값 
"First"
"Third"
"Second"
*/
```

### 참고

[https://ko.javascript.info/intro](https://ko.javascript.info/intro)

[https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif](https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif)