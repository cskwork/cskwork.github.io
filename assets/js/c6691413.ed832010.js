"use strict";(self.webpackChunkionic_docs=self.webpackChunkionic_docs||[]).push([[82295],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),h=p(n),d=a,f=h["".concat(l,".").concat(d)]||h[d]||u[d]||r;return n?o.createElement(f,i(i({ref:t},c),{},{components:n})):o.createElement(f,i({ref:t},c))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<r;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},38084:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return c},default:function(){return h}});var o=n(87462),a=n(63366),r=(n(67294),n(3905)),i=["components"],s={sidebar_label:"Loading Photos"},l="Loading Photos from the Filesystem",p={unversionedId:"vue/your-first-app/loading-photos",id:"vue/your-first-app/loading-photos",isDocsHomePage:!1,title:"Loading Photos from the Filesystem",description:"We\u2019ve implemented photo taking and saving to the filesystem. There\u2019s one last piece of functionality missing: the photos are stored in the filesystem, but we need a way to save pointers to each file so that they can be displayed again in the photo gallery.",source:"@site/docs/vue/your-first-app/4-loading-photos.md",sourceDirName:"vue/your-first-app",slug:"/vue/your-first-app/loading-photos",permalink:"/docs/vue/your-first-app/loading-photos",editUrl:"https://github.com/ionic-team/ionic-docs/edit/main/docs/vue/your-first-app/4-loading-photos.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_label:"Loading Photos"}},c=[{value:"Preferences API",id:"preferences-api",children:[],level:2}],u={toc:c};function h(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"loading-photos-from-the-filesystem"},"Loading Photos from the Filesystem"),(0,r.kt)("p",null,"We\u2019ve implemented photo taking and saving to the filesystem. There\u2019s one last piece of functionality missing: the photos are stored in the filesystem, but we need a way to save pointers to each file so that they can be displayed again in the photo gallery."),(0,r.kt)("p",null,"Fortunately, this is easy: we\u2019ll leverage the Capacitor ",(0,r.kt)("a",{parentName:"p",href:"https://capacitorjs.com/docs/apis/preferences"},"Preferences API")," to store our array of Photos in a key-value store."),(0,r.kt)("h2",{id:"preferences-api"},"Preferences API"),(0,r.kt)("p",null,"Begin by defining a constant variable that will act as the key for the store at the top of the ",(0,r.kt)("inlineCode",{parentName:"p"},"usePhotoGallery")," function in ",(0,r.kt)("inlineCode",{parentName:"p"},"src/composables/usePhotoGallery.ts"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"const PHOTO_STORAGE = 'photos';\n")),(0,r.kt)("p",null,"Next, add a ",(0,r.kt)("inlineCode",{parentName:"p"},"cachePhotos")," function that saves the Photos array as JSON to preferences:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"const cachePhotos = () => {\n  Preferences.set({\n    key: PHOTO_STORAGE,\n    value: JSON.stringify(photos.value),\n  });\n};\n")),(0,r.kt)("p",null,"Next, use the Vue ",(0,r.kt)("a",{parentName:"p",href:"https://v3.vuejs.org/guide/composition-api-introduction.html#reacting-to-changes-with-watch"},"watch function")," to watch the ",(0,r.kt)("inlineCode",{parentName:"p"},"photos")," array. Whenever the array is modified (in this case, taking or deleting photos), trigger the ",(0,r.kt)("inlineCode",{parentName:"p"},"cachePhotos")," function. Not only do we get to reuse code, but it also doesn\u2019t matter when the app user closes or switches to a different app - photo data is always saved."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"watch(photos, cachePhotos);\n")),(0,r.kt)("p",null,"Now that the photo array data is saved, create a function to retrieve the data when Tab2 loads. First, retrieve photo data from Preferences, then each photo's data into base64 format:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"const loadSaved = async () => {\n  const photoList = await Preferences.get({ key: PHOTO_STORAGE });\n  const photosInPreferences = photoList.value ? JSON.parse(photoList.value) : [];\n\n  for (const photo of photosInPreferences) {\n    const file = await Filesystem.readFile({\n      path: photo.filepath,\n      directory: Directory.Data,\n    });\n    photo.webviewPath = `data:image/jpeg;base64,${file.data}`;\n  }\n\n  photos.value = photosInPreferences;\n};\n")),(0,r.kt)("p",null,"On mobile (coming up next!), we can directly set the source of an image tag - ",(0,r.kt)("inlineCode",{parentName:"p"},'<img src="x" />')," - to each photo file on the Filesystem, displaying them automatically. On the web, however, we must read each image from the Filesystem into base64 format, because the Filesystem API stores them in base64 within ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API"},"IndexedDB")," under the hood."),(0,r.kt)("p",null,"Finally, we need a way to call the ",(0,r.kt)("inlineCode",{parentName:"p"},"loadSaved")," function when the Photo Gallery page is loaded. To do so, use the Vue ",(0,r.kt)("a",{parentName:"p",href:"https://v3.vuejs.org/guide/composition-api-introduction.html#lifecycle-hook-registration-inside-setup"},"mounted lifecycle hook"),". Earlier we had already imported ",(0,r.kt)("inlineCode",{parentName:"p"},"onMounted")," from Vue:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { ref, onMounted, watch } from 'vue';\n")),(0,r.kt)("p",null,"Within the ",(0,r.kt)("inlineCode",{parentName:"p"},"usePhotoGallery")," function, add the ",(0,r.kt)("inlineCode",{parentName:"p"},"onMounted")," function and call ",(0,r.kt)("inlineCode",{parentName:"p"},"loadSaved"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"onMounted(loadSaved);\n")),(0,r.kt)("p",null,"That\u2019s it! We\u2019ve built a complete Photo Gallery feature in our Ionic app that works on the web. Next up, we\u2019ll transform it into a mobile app for iOS and Android!"))}h.isMDXComponent=!0}}]);